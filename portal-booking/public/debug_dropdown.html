<!DOCTYPE html>
<html>
<head>
    <title>Room Dropdown Debug</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-2xl font-bold mb-6">üîç Room Dropdown Debug Test</h1>
        
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-lg font-semibold mb-4">üìä API Test Results</h2>
            <div id="api-test-results" class="bg-gray-50 p-4 rounded border">
                Testing API...
            </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-lg font-semibold mb-4">üè† Room Dropdown Test</h2>
            <form>
                <label for="room_id" class="block text-sm font-medium text-gray-700 mb-2">
                    Pilih Ruangan
                </label>
                <select id="room_id" name="room_id" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="">-- Memuat ruangan... --</option>
                </select>
                
                <div id="room-details" class="mt-4 p-4 bg-blue-50 rounded-lg hidden">
                    <h3 class="font-semibold text-blue-800">Detail Ruangan:</h3>
                    <div id="room-info"></div>
                </div>
            </form>
        </div>
    </div>

    <script>
        // API Configuration
        const API_URL = 'http://localhost:8081/api';
        const TOKEN = '1|XT7NQdIC6MDm9fkGMJDDSEuwbuG5nqEfb0kTUIud59232b32';

        // Test API connection
        async function testAPI() {
            const resultDiv = document.getElementById('api-test-results');
            
            try {
                const response = await fetch(`${API_URL}/rooms`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${TOKEN}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    
                    resultDiv.innerHTML = `
                        <div class="text-green-600">
                            ‚úÖ <strong>API Connection Successful!</strong><br>
                            üìä Status: ${response.status}<br>
                            üè† Rooms found: ${data.data ? data.data.length : 0}<br>
                            üîó URL: ${API_URL}/rooms<br>
                            üîë Token: ${TOKEN.substring(0, 20)}...
                        </div>
                    `;
                    
                    // Populate dropdown
                    populateDropdown(data.data || []);
                } else {
                    resultDiv.innerHTML = `
                        <div class="text-red-600">
                            ‚ùå <strong>API Error!</strong><br>
                            üìä Status: ${response.status}<br>
                            üí¨ Status Text: ${response.statusText}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="text-red-600">
                        ‚ùå <strong>Connection Error!</strong><br>
                        üí¨ Error: ${error.message}<br>
                        üí° Make sure layanan-ruangan service is running
                    </div>
                `;
            }
        }

        // Populate dropdown with rooms
        function populateDropdown(rooms) {
            const select = document.getElementById('room_id');
            
            // Clear existing options
            select.innerHTML = '<option value="">-- Pilih Ruangan --</option>';
            
            if (rooms.length === 0) {
                select.innerHTML += '<option value="" disabled>Tidak ada ruangan tersedia</option>';
                return;
            }

            rooms.forEach(room => {
                const option = document.createElement('option');
                option.value = room.id;
                option.textContent = `${room.name} (Kapasitas: ${room.capacity} orang)`;
                option.dataset.room = JSON.stringify(room);
                select.appendChild(option);
            });

            // Add change event listener
            select.addEventListener('change', function() {
                showRoomDetails(this.value, this.selectedOptions[0]);
            });
        }

        // Show room details
        function showRoomDetails(roomId, option) {
            const detailsDiv = document.getElementById('room-details');
            const infoDiv = document.getElementById('room-info');
            
            if (!roomId || !option.dataset.room) {
                detailsDiv.classList.add('hidden');
                return;
            }

            const room = JSON.parse(option.dataset.room);
            
            infoDiv.innerHTML = `
                <div class="grid grid-cols-2 gap-2 text-sm">
                    <div><strong>ID:</strong> ${room.id}</div>
                    <div><strong>Nama:</strong> ${room.name}</div>
                    <div><strong>Kapasitas:</strong> ${room.capacity} orang</div>
                    <div><strong>Status:</strong> ${room.status || 'available'}</div>
                    <div class="col-span-2"><strong>Fasilitas:</strong> ${room.facilities ? JSON.stringify(room.facilities) : 'Tidak ada'}</div>
                    <div class="col-span-2"><strong>Deskripsi:</strong> ${room.description || 'Tidak ada deskripsi'}</div>
                </div>
            `;
            
            detailsDiv.classList.remove('hidden');
        }

        // Run test when page loads
        document.addEventListener('DOMContentLoaded', function() {
            testAPI();
        });
    </script>
</body>
</html>
