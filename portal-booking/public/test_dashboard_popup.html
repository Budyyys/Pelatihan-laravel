<!DOCTYPE html>
<html>
<head>
    <title>Dashboard Popup Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">üß™ Dashboard Popup Form Test</h1>
        
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-semibold mb-4">üìä API Status</h2>
            <div id="api-status" class="bg-gray-50 p-4 rounded border">
                Testing API connection...
            </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-semibold mb-4">üéØ Popup Form Test</h2>
            <button onclick="openCreateForm()" 
                    class="bg-gradient-to-r from-orange-500 to-orange-600 text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transition-all duration-200">
                <i class="fas fa-plus mr-2"></i>
                Test Popup Form
            </button>
        </div>
    </div>

    <!-- Modal Popup (same as dashboard) -->
    <div class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4" id="createBookingModal">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] flex flex-col">
            <!-- Header -->
            <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4 rounded-t-xl flex justify-between items-center">
                <h3 class="text-lg font-bold">
                    <i class="fas fa-calendar-plus mr-2"></i>
                    Test Booking Form
                </h3>
                <button class="text-white hover:text-gray-200 text-xl" onclick="closeCreateForm()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- Content -->
            <div class="flex-1 overflow-y-auto p-6">
                <form id="testForm">
                    <div class="space-y-4">
                        <div>
                            <label for="user_name" class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-user mr-2"></i>Nama Pengguna
                            </label>
                            <input type="text" id="user_name" name="user_name" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                   placeholder="Masukkan nama" value="Test User">
                        </div>

                        <div>
                            <label for="room_id" class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-door-open mr-2"></i>Pilih Ruangan
                            </label>
                            <select id="room_id" name="room_id" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">-- Memuat ruangan... --</option>
                            </select>
                            <div id="room-details" class="mt-3 hidden bg-blue-50 p-3 rounded-lg">
                                <div id="room-info"></div>
                            </div>
                        </div>

                        <div>
                            <label for="title" class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-heading mr-2"></i>Judul Meeting
                            </label>
                            <input type="text" id="title" name="title" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                   placeholder="Contoh: Meeting Tim Development" value="Test Meeting">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-clock mr-2"></i>Jadwal Meeting
                            </label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="start_time" class="block text-xs text-gray-600 mb-1">Waktu Mulai</label>
                                    <input type="datetime-local" id="start_time" name="start_time" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label for="end_time" class="block text-xs text-gray-600 mb-1">Waktu Selesai</label>
                                    <input type="datetime-local" id="end_time" name="end_time" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Footer -->
            <div class="bg-gray-50 p-4 rounded-b-xl border-t border-gray-200">
                <div class="flex flex-col gap-3">
                    <button type="button" onclick="testSubmit()" 
                            class="w-full bg-orange-500 hover:bg-orange-600 text-white py-3 px-6 rounded-lg font-bold text-lg">
                        üöÄ Test Submit
                    </button>
                    <button type="button" onclick="closeCreateForm()" 
                            class="w-full bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg font-semibold">
                        Batal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_URL = 'http://room-service-nginx/api';
        const TOKEN = '1|XT7NQdIC6MDm9fkGMJDDSEuwbuG5nqEfb0kTUIud59232b32';

        // Test API connection
        async function testAPI() {
            const statusDiv = document.getElementById('api-status');
            
            try {
                const response = await fetch(`http://localhost:8080/test-rooms`);
                const data = await response.json();
                
                statusDiv.innerHTML = `
                    <div class="text-green-600">
                        ‚úÖ <strong>API Connection Successful!</strong><br>
                        üîó API URL: ${data.api_url}<br>
                        üîë Token: ${data.token_preview}<br>
                        üè† Rooms available: ${data.rooms_count}
                    </div>
                `;
                
                // Populate dropdown
                populateRoomDropdown(data.rooms || []);
                
            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="text-red-600">
                        ‚ùå <strong>API Connection Failed!</strong><br>
                        Error: ${error.message}
                    </div>
                `;
            }
        }

        // Populate room dropdown
        function populateRoomDropdown(rooms) {
            const select = document.getElementById('room_id');
            select.innerHTML = '<option value="">-- Pilih Ruangan --</option>';
            
            if (rooms.length === 0) {
                select.innerHTML += '<option value="" disabled>Tidak ada ruangan tersedia</option>';
                return;
            }

            rooms.forEach(room => {
                const statusText = room.status === 'available' ? 'Tersedia' : 
                                  room.status === 'busy' ? 'Sedang Digunakan' : 
                                  room.status === 'maintenance' ? 'Maintenance' : 'Tidak Diketahui';
                
                const option = document.createElement('option');
                option.value = room.id;
                option.textContent = `üè† ${room.name} (üë•${room.capacity}) - ${statusText}`;
                option.dataset.room = JSON.stringify(room);
                option.disabled = room.status === 'busy';
                select.appendChild(option);
            });

            // Add change listener
            select.addEventListener('change', showRoomDetails);
        }

        // Show room details
        function showRoomDetails() {
            const select = document.getElementById('room_id');
            const detailsDiv = document.getElementById('room-details');
            const infoDiv = document.getElementById('room-info');
            
            if (!select.value || !select.selectedOptions[0].dataset.room) {
                detailsDiv.classList.add('hidden');
                return;
            }

            const room = JSON.parse(select.selectedOptions[0].dataset.room);
            
            infoDiv.innerHTML = `
                <h4 class="font-semibold text-blue-800 mb-2">Detail Ruangan: ${room.name}</h4>
                <div class="grid grid-cols-2 gap-2 text-sm">
                    <div><strong>ID:</strong> ${room.id}</div>
                    <div><strong>Kapasitas:</strong> ${room.capacity} orang</div>
                    <div><strong>Status:</strong> ${room.status || 'available'}</div>
                    <div><strong>Fasilitas:</strong> ${room.facilities ? room.facilities.length : 0} item</div>
                </div>
            `;
            
            detailsDiv.classList.remove('hidden');
        }

        // Modal functions
        function openCreateForm() {
            const modal = document.getElementById('createBookingModal');
            modal.classList.remove('hidden');
            
            // Set default datetime
            const now = new Date();
            const todayString = now.toISOString().slice(0, 16);
            document.getElementById('start_time').value = todayString;
            
            const endTime = new Date(now.getTime() + (60 * 60 * 1000));
            document.getElementById('end_time').value = endTime.toISOString().slice(0, 16);
        }

        function closeCreateForm() {
            const modal = document.getElementById('createBookingModal');
            modal.classList.add('hidden');
        }

        function testSubmit() {
            const formData = {
                user_name: document.getElementById('user_name').value,
                room_id: document.getElementById('room_id').value,
                title: document.getElementById('title').value,
                start_time: document.getElementById('start_time').value,
                end_time: document.getElementById('end_time').value
            };
            
            alert('Test Submit Data:\n' + JSON.stringify(formData, null, 2));
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            testAPI();
        });

        // Close modal when clicking outside
        document.getElementById('createBookingModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeCreateForm();
            }
        });
    </script>
</body>
</html>
